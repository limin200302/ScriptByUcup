<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mamet Store ‚Äì Top Up Game & Aplikasi</title>
  <link rel="stylesheet" href="assets/style.css" />
  <script type="module" src="script.js" defer></script>
</head>
<body>
  <!-- Script Supabase -->
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabaseUrl = "https://etfbdevjytilaykogzwa.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV0ZmJkZXZqeXRpbGF5a29nendhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA0NjE0MjAsImV4cCI6MjA2NjAzNzQyMH0.rGwSOp2_l9eWK2B7Fk7BFo0_JK4BOY5GAYJOa3C58tM";
    const supabase = createClient(supabaseUrl, supabaseKey);

    const greeting = document.createElement("div");
    greeting.className = "greeting";
    greeting.style.cssText = "text-align:center; margin: 1rem 0; font-weight:bold; color:#ffcc00;";
    document.body.prepend(greeting);

    const logoutBtn = document.createElement("button");
    logoutBtn.textContent = "üö™ Logout";
    logoutBtn.style.cssText = "position:absolute; right:1rem; top:1rem; padding:5px 10px; background:#222; color:white; border:none; border-radius:5px; cursor:pointer;";
    logoutBtn.onclick = async () => {
      await supabase.auth.signOut();
      location.href = "login.html";
    };

    const user = (await supabase.auth.getUser()).data.user;
    if (!user) {
      location.href = "login.html";
    } else {
      greeting.textContent = `Halo, ${user.user_metadata.username || user.email} üëã`;
      document.body.prepend(logoutBtn);

      // Load transaksi
      const { data: transaksi, error } = await supabase
        .from("transactions")
        .select("*")
        .eq("user_id", user.id)
        .order("created_at", { ascending: false });

      if (transaksi && transaksi.length > 0) {
        const section = document.createElement("section");
        section.className = "history";
        section.innerHTML = `<h3>üßæ Riwayat Transaksi</h3><ul>${transaksi.map(t => `
          <li>
            ${t.item_name} (${t.category}) - Rp ${t.price.toLocaleString()}<br />
            <small>Status: ${t.status} - ${new Date(t.created_at).toLocaleString("id-ID")}</small>
          </li>`).join("")}</ul>`;
        document.body.appendChild(section);
      }
    }
  </script>

  <!-- Header -->
  <header class="main-header">
    <button class="hamburger" id="hamburgerBtn">‚ò∞</button>
    <div class="logo-text">Mamet Ucup Store</div>
  </header>

  <!-- Sidebar Menu -->
  <div id="mobile-menu" class="mobile-menu">
    <div class="menu-header">
      <button id="closeMenu">‚úñ</button>
    </div>
    <ul>
      <li><a href="index.html">üè† Beranda</a></li>
      <li><a href="tentang.html">üìÑ Tentang</a></li>
    </ul>
  </div>
  <div class="menu-overlay" id="menu-overlay"></div>

  <!-- Hero Slider -->
  <section class="hero">
    <div class="hero-slider">
      <img src="assets/img/slider1.jpeg" class="bg-slide active" alt="Slider 1">
      <img src="assets/img/slider2.jpeg" class="bg-slide" alt="Slider 2">
      <img src="assets/img/slider3.jpeg" class="bg-slide" alt="Slider 3">
    </div>
    <div class="hero-content">
      <h1>Selamat Datang di Mamet Store</h1>
      <p>Top Up Game & Aplikasi dengan cepat dan terpercaya!</p>
      <a href="#" class="btn-cta">Mulai Belanja</a>
    </div>
  </section>

  <!-- Game List -->
  <section class="menu-section">
    <h2>Game & Aplikasi Populer</h2>
    <div class="menu-grid">
      <a href="ballpool.html" class="menu-item"><img src="assets/img/8Ballpool.png" alt="8Ball Pool"><span>8Ball Pool</span></a>
      <div class="menu-item"><img src="assets/img/Mobilelegends.png" alt="Mobile Legends"><span>Mobile Legends</span></div>
      <div class="menu-item"><img src="assets/img/coc.png" alt="Clash of Clans"><span>Clash of Clans</span></div>
      <div class="menu-item"><img src="assets/img/freefire.png" alt="Free Fire"><span>Free Fire</span></div>
      <div class="menu-item"><img src="assets/img/bigolive.png" alt="Bigo Live"><span>Bigo Live</span></div>
      <div class="menu-item"><img src="assets/img/iqiyi.png" alt="iQIYI"><span>iQIYI</span></div>
      <div class="menu-item"><img src="assets/img/tt.png" alt="TikTok"><span>TikTok</span></div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="main-footer">
    <p>&copy; 2025 Mamet Store. All rights reserved.</p>
  </footer>

  <!-- Floating Contact -->
  <div class="floating-contact">
    <input type="checkbox" id="toggle-contact" hidden />
    <label for="toggle-contact" class="contact-toggle">Contact</label>
    <div class="contact-icons">
      <a href="https://www.facebook.com/mamet.ucupp" target="_blank" title="Facebook"><img src="assets/img/facebook.png" alt="Facebook" /></a>
      <a href="https://wa.me/6285713056206" target="_blank" title="WhatsApp"><img src="assets/img/whatsapp.png" alt="WhatsApp" /></a>
    </div>
  </div>
</body>
</html>
